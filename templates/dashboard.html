<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Dai Trader Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
</head>
<body>
    <div class="dashboard">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>ü§ñ Dai Trader Dashboard</h1>
                <div class="header-actions">
                    <span id="last-update" class="update-time">Last updated: --</span>
                    <a href="/logout" class="btn-logout">Logout</a>
                </div>
            </div>
        </header>

        <!-- Bot Control Panel -->
        <div class="control-panel">
            <div class="container">
                <h2>üéõÔ∏è Bot Controls</h2>
                <div class="controls-grid">
                    <div class="control-card">
                        <div class="control-header">
                            <span class="control-icon">üõ°Ô∏è</span>
                            <h3>Safe Mode</h3>
                        </div>
                        <p class="control-description">Automatically reduce risk during unfavorable market conditions</p>
                        <div class="toggle-container">
                            <label class="toggle">
                                <input type="checkbox" id="toggle-safe-mode" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <span id="safe-mode-status" class="toggle-status">Enabled</span>
                        </div>
                        <div id="safe-mode-info" class="control-info"></div>
                    </div>
                    
                    <div class="control-card">
                        <div class="control-header">
                            <span class="control-icon">ü§ñ</span>
                            <h3>Trading Bot</h3>
                        </div>
                        <p class="control-description">Start or stop the automated trading bot</p>
                        <div class="toggle-container">
                            <label class="toggle">
                                <input type="checkbox" id="toggle-bot" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <span id="bot-status" class="toggle-status active">Running</span>
                        </div>
                    </div>
                    
                    <div class="control-card">
                        <div class="control-header">
                            <span class="control-icon">‚öñÔ∏è</span>
                            <h3>Risk Level</h3>
                        </div>
                        <p class="control-description">Adjust overall risk tolerance</p>
                        <select id="risk-level" class="control-select">
                            <option value="conservative">Conservative (Low Risk)</option>
                            <option value="moderate" selected>Moderate (Balanced)</option>
                            <option value="aggressive">Aggressive (High Risk)</option>
                        </select>
                        <div class="risk-breakdown">
                            <div class="risk-bar">
                                <span>High Risk: <strong id="risk-high">20%</strong></span>
                                <div class="progress-bar"><div class="progress high" style="width: 20%"></div></div>
                            </div>
                            <div class="risk-bar">
                                <span>Medium Risk: <strong id="risk-medium">30%</strong></span>
                                <div class="progress-bar"><div class="progress medium" style="width: 30%"></div></div>
                            </div>
                            <div class="risk-bar">
                                <span>Low Risk: <strong id="risk-low">50%</strong></span>
                                <div class="progress-bar"><div class="progress low" style="width: 50%"></div></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-card">
                        <div class="control-header">
                            <span class="control-icon">üß†</span>
                            <h3>AI Learning</h3>
                        </div>
                        <p class="control-description">Enable reinforcement learning for strategy optimization</p>
                        <div class="toggle-container">
                            <label class="toggle">
                                <input type="checkbox" id="toggle-learning" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <span id="learning-status" class="toggle-status">Active</span>
                        </div>
                    </div>
                    
                    <div class="control-card">
                        <div class="control-header">
                            <span class="control-icon">üîî</span>
                            <h3>Alerts</h3>
                        </div>
                        <p class="control-description">Enable notifications for trades and important events</p>
                        <div class="toggle-container">
                            <label class="toggle">
                                <input type="checkbox" id="toggle-alerts" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <span id="alerts-status" class="toggle-status">Enabled</span>
                        </div>
                    </div>
                    
                    <div class="control-card emergency">
                        <div class="control-header">
                            <span class="control-icon">üö®</span>
                            <h3>Emergency Stop</h3>
                        </div>
                        <p class="control-description">Immediately close all positions and halt trading</p>
                        <button id="emergency-stop" class="btn-emergency">STOP ALL TRADING</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="container">
            <!-- Account Overview -->
            <section class="section">
                <h2>Account Overview</h2>
                <div class="cards">
                    <div class="card">
                        <div class="card-header">Portfolio Value</div>
                        <div class="card-value" id="portfolio-value">$0.00</div>
                        <div class="card-change" id="portfolio-change">--</div>
                    </div>
                    <div class="card">
                        <div class="card-header">Cash Available</div>
                        <div class="card-value" id="cash-value">$0.00</div>
                    </div>
                    <div class="card">
                        <div class="card-header">Buying Power</div>
                        <div class="card-value" id="buying-power">$0.00</div>
                    </div>
                    <div class="card">
                        <div class="card-header">Active Positions</div>
                        <div class="card-value" id="position-count">0</div>
                    </div>
                </div>
            </section>

            <!-- Performance Metrics -->
            <section class="section">
                <h2>Performance Metrics</h2>
                <div class="cards">
                    <div class="card">
                        <div class="card-header">Total Trades</div>
                        <div class="card-value" id="total-trades">0</div>
                    </div>
                    <div class="card">
                        <div class="card-header">Win Rate</div>
                        <div class="card-value" id="win-rate">0%</div>
                        <div class="card-subtext"><span id="winning-trades">0</span> wins / <span id="losing-trades">0</span> losses</div>
                    </div>
                    <div class="card">
                        <div class="card-header">Total P&L</div>
                        <div class="card-value" id="total-pnl">$0.00</div>
                    </div>
                    <div class="card">
                        <div class="card-header">Avg P&L per Trade</div>
                        <div class="card-value" id="avg-pnl">$0.00</div>
                    </div>
                </div>
            </section>

            <!-- AI Learning Stats -->
            <section class="section">
                <h2>üß† AI Learning Statistics</h2>
                <div class="cards">
                    <div class="card">
                        <div class="card-header">States Learned</div>
                        <div class="card-value" id="states-learned">0</div>
                    </div>
                    <div class="card">
                        <div class="card-header">AI Win Rate</div>
                        <div class="card-value" id="ai-win-rate">0%</div>
                    </div>
                    <div class="card">
                        <div class="card-header">Avg Reward</div>
                        <div class="card-value" id="avg-reward">0.000</div>
                    </div>
                    <div class="card">
                        <div class="card-header">Exploration Rate</div>
                        <div class="card-value" id="exploration-rate">0%</div>
                    </div>
                </div>
            </section>

            <!-- Current Positions -->
            <section class="section">
                <h2>Current Positions</h2>
                <div class="table-wrapper">
                    <div class="table-container">
                        <table id="positions-table">
                            <thead>
                            <tr>
                                <th>Symbol</th>
                                <th>Qty</th>
                                <th>Avg Price</th>
                                <th>Current Price</th>
                                <th>Market Value</th>
                                <th>P&L</th>
                                <th>P&L %</th>
                            </tr>
                        </thead>
                        <tbody id="positions-body">
                            <tr>
                                <td colspan="7" class="no-data">No open positions</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                </div>
            </section>

            <!-- Recent Trades -->
            <section class="section">
                <h2>Recent Trades</h2>
                <div class="table-wrapper">
                    <div class="table-container">
                        <table id="trades-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Symbol</th>
                                <th>Side</th>
                                <th>Qty</th>
                                <th>Entry</th>
                                <th>Exit</th>
                                <th>P&L</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="trades-body">
                            <tr>
                                <td colspan="8" class="no-data">No trades yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                </div>
            </section>

            <!-- Portfolio Chart -->
            <section class="section">
                <h2>Portfolio Performance</h2>
                <div class="chart-container">
                    <canvas id="portfolio-chart"></canvas>
                </div>
            </section>

            <!-- Bot Configuration -->
            <section class="section">
                <h2>Bot Configuration</h2>
                <div class="config-grid">
                    <div class="config-item">
                        <strong>Trading Mode:</strong>
                        <span id="trading-mode">--</span>
                    </div>
                    <div class="config-item">
                        <strong>Strategy:</strong>
                        <span id="strategy">--</span>
                    </div>
                    <div class="config-item">
                        <strong>Watchlist:</strong>
                        <span id="watchlist">--</span>
                    </div>
                </div>
            </section>

            <!-- Live Logs -->
            <section class="section">
                <h2>Recent Logs</h2>
                <div class="logs-container" id="logs-container">
                    <div class="log-entry">Loading logs...</div>
                </div>
            </section>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
